-- database: /Users/lachlan/Documents/Handball-Website/matchmaking/resources/database.db

-- Use the â–· button in the top right corner to run the entire file.

SELECT  -- get all unfinished games
    serving.name, receiving.name, servingScore, receivingScore, games.id
    FROM games 
    INNER JOIN teams AS serving ON games.servingTeam = serving.id 
    INNER JOIN teams as receiving ON games.receivingTeam = receiving.id 
    WHERE tournamentId = 8 
    AND games.bestPlayer = NULL;

-- this will be a doozey, but we need to get the finals of a game if there are finals, but if there are not then
SELECT 
    serving.name, receiving.name, servingScore, receivingScore, games.id
    FROM games 
    INNER JOIN teams AS serving ON games.servingTeam = serving.id 
    INNER JOIN teams as receiving ON games.receivingTeam = receiving.id 
    WHERE tournamentId = 8 AND
    CASE 
        WHEN (SELECT count(*) FROM games WHERE tournamentId = 8 AND isFinal = 1) > 0 THEN
            isFinal = 1
        ELSE
            round = (SELECT max(round) FROM games WHERE tournamentId = 8) 
    END;


-- get umpire name from umpire id:
SELECT 
    umpire.name
    FROM games
    LEFT JOIN officials AS u ON games.official = u.id
        LEFT JOIN people AS umpire ON u.personId = umpire.id;
    

SELECT 
    serving.name, receiving.name, servingScore, receivingScore, games.id, round, umpire.name, scorer.name, court 
    FROM games 
    INNER JOIN teams AS serving ON games.servingTeam = serving.id 
    INNER JOIN teams AS receiving ON games.receivingTeam = receiving.id
    LEFT JOIN officials AS u ON games.official = u.id
        LEFT JOIN people AS umpire ON u.personId = umpire.id
    LEFT JOIN officials AS s ON games.scorer = s.id
        LEFT JOIN people AS scorer ON s.personId = scorer.id
    WHERE
        tournamentId = 7 AND
        isFinal = 0;

SELECT
    twoCourts, count(scorer)>0
    FROM tournaments
    INNER JOIN games ON games.tournamentId = tournaments.id
    WHERE tournaments.id = 3;